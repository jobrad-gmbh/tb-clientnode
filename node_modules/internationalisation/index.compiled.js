'use strict';
(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b(require('babel-runtime/helpers/asyncToGenerator'),require('clientnode')):'function'==typeof define&&define.amd?define('internationalisation',['babel-runtime/helpers/asyncToGenerator','clientnode'],b):'object'==typeof exports?exports.internationalisation=b(require('babel-runtime/helpers/asyncToGenerator'),require('clientnode')):a.internationalisation=b(a['babel-runtime/helpers/asyncToGenerator'],a.clientnode)})(this,function(a,b){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)}([function(a,b,c){a.exports=c(1)},function(a,b,c){'use strict';(function(a){var d=c(3),e=function(b){return b&&b.__esModule?b:{default:b}}(d),f=c(4);b.__esModule=!0,b.$=void 0;try{a.require('source-map-support/register')}catch(b){}const j=b.$=f.$;class g extends j.Tools.class{initialize(i={},a='',b={},c=null,d=[],e={}){var f=this;this.currentLanguage=a,this.knownTranslation=b,this._$domNodeToFade=c,this._replacements=d,this._textNodesWithKnownTranslation=e,this._options={domNodeSelectorPrefix:'body',default:'enUS',selection:[],initial:null,templateDelimiter:{pre:'{{',post:'}}'},fadeEffect:!0,textNodeParent:{showAnimation:[{opacity:1},{duration:'fast'}],hideAnimation:[{opacity:0},{duration:'fast'}]},preReplacementLanguagePattern:'^\\|({1})$',replacementLanguagePattern:'^([a-z]{2}[A-Z]{2}):((.|\\s)*)$',currentLanguagePattern:'^[a-z]{2}[A-Z]{2}$',replacementDomNodeName:['#comment','langreplacement'],replaceDomNodeNames:['#text','langreplace'],toolsLockDescription:'{1}Switch',languageHashPrefix:'language-',currentLanguageIndicatorClassName:'current',sessionDescription:'{1}',languageMapping:{deDE:['de','de_de','de-de','german','deutsch'],enUS:['en','en_us','en-us'],enEN:['en_en','en-en','english'],frFR:['fr','fr_fr','fr-fr','french']},onSwitched:this.constructor.noop,onEnsured:this.constructor.noop,onSwitch:this.constructor.noop,onEnsure:this.constructor.noop,domNode:{knownTranslation:'div.toc'}},super.initialize(i),this._options.preReplacementLanguagePattern=this.constructor.stringFormat(this._options.preReplacementLanguagePattern,this._options.replacementLanguagePattern.substr(1,this._options.replacementLanguagePattern.length-2)),this._options.toolsLockDescription=this.constructor.stringFormat(this._options.toolsLockDescription,this.constructor._name),this._options.sessionDescription=this.constructor.stringFormat(this._options.sessionDescription,this.constructor._name),this.$domNodes=this.grabDomNode(this._options.domNode),this.$domNodes.switchLanguageButtons=j(`a[href^="#${this._options.languageHashPrefix}"]`),this._movePreReplacementNodes(),this.currentLanguage=this._normalizeLanguage(this._options.default);const g=this._determineUsefulLanguage();return this.on(this.$domNodes.switchLanguageButtons,'click',function(b){return b.preventDefault(),f.switch(j(b.target).attr('href').substr(f._options.languageHashPrefix.length+1))}),this.currentLanguage===g?j.when(this._switchCurrentLanguageIndicator(g)):this.switch(g,!0)}switch(g,a=!1){var b=this;return!0!==g&&this._options.selection.length&&!this._options.selection.includes(g)?(this.debug('"{1}" isn\'t one of the allowed languages.',g),j.when(this)):this.acquireLock(this._options.toolsLockDescription,function(){if(!0===g?(a=!0,g=b.currentLanguage):g=b._normalizeLanguage(g),a&&g!==b._options.default||b.currentLanguage!==g){let c='Switch to';a&&(c='Ensure'),b.debug('{1} "{2}".',c,g),b._switchCurrentLanguageIndicator(g),b.fireEvent(a?'ensure':'switch',!0,b,b.currentLanguage,g),b._$domNodeToFade=null,b._replacements=[];const[d,e]=b._collectTextNodesToReplace(g,a);return b._ensureLastTextNodeHavingLanguageIndicator(d,e,a),b._handleSwitchEffect(g,a)}return b.debug('"{1}" is already current selected language.',g),b.releaseLock(b._options.toolsLockDescription),j.when(b)})}refresh(){return this._movePreReplacementNodes().switch(!0)}_handleSwitchEffect(f,a){var g=this;return(0,e.default)(function*(){const c=g.currentLanguage;return!a&&g._options.fadeEffect&&g._$domNodeToFade?(yield g._$domNodeToFade.animate(...g._options.textNodeParent.hideAnimation).promise(),g._switchLanguage(f),g._$domNodeToFade&&(yield g._$domNodeToFade.animate(...g._options.textNodeParent.showAnimation).promise(),yield g.fireEvent(a?'ensured':'switched',!0,g,c,f),g.releaseLock(g._options.toolsLockDescription)),g):(g._switchLanguage(f),yield g.fireEvent(a?'ensured':'switched',!0,g,c,f),g.releaseLock(g._options.toolsLockDescription),g)})()}_movePreReplacementNodes(){const f=this;return this.$domNodes.parent.find(':not(iframe)').contents().each(function(){const g=j(this),a=g.prop('nodeName').toLowerCase();if(f._options.replacementDomNodeName.includes(a)){['#comment','#text'].includes(a)||g.hide();const b=new RegExp(f._options.preReplacementLanguagePattern),c=g.prop('textContent').match(b);if(c&&c[0]){g.prop('textContent',g.prop('textContent').replace(b,c[1]));let d=!1;g.parent().contents().each(function(){return d&&j(this).Tools('text').trim()?(g.appendTo(this),!1):void(g[0]===this&&(d=!0))})}}}),this}_collectTextNodesToReplace(k,a){let l=null,c=null,d=null,e=null;this.knownTranslation={};const f=this;return this.$domNodes.parent.find(':not(iframe)').contents().each(function(){const g=j(this),h=g.prop('nodeName').toLowerCase();if(f._options.replaceDomNodeNames.includes(h.toLowerCase()))g.Tools('text').trim()&&0===g.parents(f._options.replaceDomNodeNames.join()).length&&(e=f._ensureLastTextNodeHavingLanguageIndicator(d,e,a),l=g);else if(l){if(f._options.replacementDomNodeName.includes(h)){let a=g.prop('textContent');'#comment'!==h&&(a=g.html());const b=a.match(new RegExp(f._options.replacementLanguagePattern));return Array.isArray(b)&&b[1]===k?(f.knownTranslation[l.Tools('text').trim()]=b[2].trim(),f._registerTextNodeToChange(l,g,b,c),d=l,e=c,l=null,c=null):g.prop('textContent').match(new RegExp(f._options.currentLanguagePattern))&&(c=g),!0}d=null,e=null,l=null,c=null}}),this._registerKnownTextNodes(),[d,e]}_registerKnownTextNodes(){this._textNodesWithKnownTranslation={};const c=this;return this.$domNodes.knownTranslation.find(':not(iframe)').contents().each(function(){const a=j(this);!c._options.replaceDomNodeNames.includes(a.prop('nodeName').toLowerCase())&&a.Tools('text').trim()&&0===a.parents(c._options.replaceDomNodeNames.join()).length&&c.knownTranslation.hasOwnProperty(a.Tools('text').trim())&&(c._addTextNodeToFade(a),c._textNodesWithKnownTranslation[c.knownTranslation[a.prop('textContent').trim()]]=c._textNodesWithKnownTranslation.hasOwnProperty(c.knownTranslation[a.prop('textContent').trim()])?c._textNodesWithKnownTranslation[c.knownTranslation[a.prop('textContent').trim()]].add(a):a)}),this}_normalizeLanguage(c){for(const a in this._options.languageMapping)if(this._options.languageMapping.hasOwnProperty(a)&&(this._options.languageMapping[a].includes(a.toLowerCase())||this._options.languageMapping[a].push(a.toLowerCase()),this._options.languageMapping[a].includes(c.toLowerCase())))return a;return this._options.default}_determineUsefulLanguage(){let b;return this._options.initial?b=this._options.initial:'localStorage'in j.global&&j.global.localStorage.getItem(this._options.sessionDescription)?(b=j.global.localStorage.getItem(this._options.sessionDescription),this.debug('Determine "{1}", because of local storage information.',b)):'navigator'in j.global&&j.global.navigator.language?(b=j.global.navigator.language,this.debug('Determine "{1}", because of browser settings.',b)):(b=this._options.default,this.debug('Determine "{1}", because of default option.',b)),b=this._normalizeLanguage(b),this._options.selection.length&&!this._options.selection.includes(b)&&(this.debug('"{1}" isn\'t one of the allowed languages. Set language to "{2}".',b,this._options.selection[0]),b=this._options.selection[0]),'localStorage'in j.global&&j.global.localStorage.setItem(this._options.sessionDescription,b),b}_addTextNodeToFade(c){const a=c.parent();return this._$domNodeToFade=this._$domNodeToFade?this._$domNodeToFade.add(a):a,this}_registerTextNodeToChange(e,f,g,c){return this._addTextNodeToFade(e),f&&this._replacements.push({$textNodeToTranslate:e,$nodeToReplace:f,textToReplace:g[2],$currentLanguageDomNode:c}),this}_ensureLastTextNodeHavingLanguageIndicator(e,a,f){if(e&&!a){let b=this.currentLanguage;f&&(b=this._options.default),a=j(`<!--${b}-->`),e.after(a)}return a}_switchLanguage(g){for(const h of this._replacements){let a=h.$textNodeToTranslate.html();'#text'===h.$textNodeToTranslate.prop('nodeName')&&(a=h.$textNodeToTranslate.prop('textContent'));const b=a.trim();if(!this._options.templateDelimiter||!b.endsWith(this._options.templateDelimiter.post)&&this._options.templateDelimiter.post){let b=h.$currentLanguageDomNode;if(!h.$currentLanguageDomNode){b=j('body');let c=!1;h.$textNodeToTranslate.parent().contents().each(function(){return c?(h.$currentLanguageDomNode=b=j(this),!1):void(this===h.$textNodeToTranslate[0]&&(c=!0))})}const c=b.prop('textContent');g===c&&this.warn(`Text node "${h.textToReplace}" is marked `+`as "${c}" and has same translation `+'language as it already is.');const d=h.$nodeToReplace.prop('nodeName').toLowerCase();'#comment'===d?h.$textNodeToTranslate.after(j(`<!--${c}:${a}-->`)):h.$textNodeToTranslate.after(j(`<${d}>${c}:${a}</`+`${d}>`).hide()),h.$textNodeToTranslate.after(j(`<!--${g}-->`)),'#text'===h.$textNodeToTranslate.prop('nodeName')?h.$textNodeToTranslate.prop('textContent',h.textToReplace):h.$textNodeToTranslate.html(h.textToReplace),b.remove(),h.$nodeToReplace.remove()}}for(const a in this._textNodesWithKnownTranslation)this._textNodesWithKnownTranslation.hasOwnProperty(a)&&this._textNodesWithKnownTranslation[a].prop('textContent',a);return'localStorage'in j.global&&j.global.localStorage.setItem(this._options.sessionDescription,g),this.currentLanguage=g,this}_switchCurrentLanguageIndicator(b){return j(`a[href="#${this._options.languageHashPrefix}`+`${this.currentLanguage}"].`+this._options.currentLanguageIndicatorClassName).removeClass(this._options.currentLanguageIndicatorClassName),j(`a[href="#${this._options.languageHashPrefix}${b}"]`).addClass(this._options.currentLanguageIndicatorClassName),this}}b.default=g,g._name='Language',j.Language=function(...b){return j.Tools().controller(g,b)},j.Language.class=g}).call(b,c(2)(a))},function(a){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],!a.children&&(a.children=[]),Object.defineProperty(a,'loaded',{enumerable:!0,get:function(){return a.l}}),Object.defineProperty(a,'id',{enumerable:!0,get:function(){return a.i}}),a.webpackPolyfill=1),a}},function(b){b.exports=a},function(a){a.exports=b}])});